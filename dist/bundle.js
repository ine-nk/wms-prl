!function(t){var e={};function n(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(s,o,function(e){return t[e]}.bind(null,o));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(0);class s{constructor(t){this.$el=document.getElementById(t),this.init()}init(){}onShow(){}onHide(){}hide(){this.$el.classList.add("hide"),this.onHide()}show(){this.$el.classList.remove("hide"),this.onShow()}}function o(){localStorage.setItem("visited",JSON.stringify(!0)),console.log("click btn header",this.$el),this.hide()}function i(t){t.preventDefault(),t.target.classList.contains("tab")&&(Array.from(this.$el.querySelectorAll(".tab")).forEach(t=>{t.classList.remove("active")}),t.target.classList.add("active"),console.log("tabClickHandler event.target => ",t.target)),console.log("navigation -> this.tabs",this.tabs);const e=this.tabs.find(e=>e.name===t.target.dataset.name);console.log("navigation : activeTab => ",e),this.tabs.forEach(t=>t.component.hide()),e.component.show()}class r{constructor(t,e){this.form=t,this.controls=e}value(){const t={};return Object.keys(this.controls).forEach(e=>{t[e]=this.form[e].value}),t}clear(){Object.keys(this.controls).forEach(t=>{this.form[t].value=""})}isValid(){let t=!0;return Object.keys(this.controls).forEach(e=>{const n=this.controls[e];let s=!0;n.forEach(t=>{s=t(this.form[e].value)&&s}),s?a(this.form[e]):function(t){a(t),console.log(t.name);let e='<p class="validation-error">Введите не менее 10 символов</p>';"title"===t.name&&(e='<p class="validation-error">Это поле не должно быть пустым</p>');t.classList.add("invalid"),t.insertAdjacentHTML("afterend",e)}(this.form[e]),t=t&&s}),t}}function a(t){t.classList.remove("invalid"),t.nextSibling&&t.closest(".form-control").removeChild(t.nextSibling)}class l{static required(t=""){return t&&t.trim()}static minLength(t){return e=>e.length>=t}}async function c(t){const e=await fetch(t);return await e.json()}const d=new class{constructor(t){this.url=t}async createPost(t){try{return c(new Request(this.url+"posts.json",{method:"post",body:JSON.stringify(t)}))}catch(t){console.error(t)}}async fetchPosts(){try{return c(new Request(this.url+"posts.json",{method:"get"}))}catch(t){console.error("ошибка при получении данных из базы",t)}}async fetchPostById(t){try{return c(new Request(`${this.url}posts/${t}.json`,{method:"get"}))}catch(t){console.error("ошибка при получении данных из базы",t)}}}("https://js-wfm-ine.firebaseio.com/");async function u(t){if(t.preventDefault(),this.form.isValid()){const t={date:(new Date).toLocaleDateString(),...this.form.value()};await d.createPost(t),this.form.clear(),console.log("Submit",t,t.type,t.title,t.fulltext),alert("Запись в базе данных успешно создана!")}}function h(t,e={}){const n="news"===t.type?'<li class="tag tag-blue tag-rounded">Новость</li>':'<li class="tag  tag-rounded">Заметка</li>',s=(JSON.parse(localStorage.getItem("favorites"))||[]).includes(t.id)?`<button class="button-round button-small button-danger " data-id="${t.id}" data-title="${t.title}">Удалить</button>`:`<button class="button-round button-small button-primary " data-id="${t.id}"data-title="${t.title}">Сохранить</button>`;return`\n    <div class="panel">\n      <div class="panel-head">\n        <p class="panel-title">${t.title}</p>\n        <ul class="tags">\n          ${n}\n        </ul>\n      </div>\n      <div class="panel-body">\n        <p class="multi-line">${t.fulltext}</p>\n      </div>\n      <div class="panel-footer w-panel-footer">\n        <small>${t.date}</small>\n        ${e.withButton?s:""}\n      </div>\n    </div>\n  `}function f(t){const e=t.target,n=e.dataset.id;e.dataset.title;if(n){let t=JSON.parse(localStorage.getItem("favorites"))||[];console.log(t),t.includes(n)?(t=t.filter(t=>t!==n),e.textContent="Сохранить",e.classList.add("button-primary"),e.classList.remove("button-danger")):(t.push(n),e.textContent="Удалить",e.classList.remove("button-primary"),e.classList.add("button-danger")),localStorage.setItem("favorites",JSON.stringify(t))}}async function g(t){if(t.preventDefault(),t.target.classList.contains("js-link")){const e=t.target.textContent;this.$el.innerHTML="",console.log("event.target.textContent postID = ",e),this.loader.show();const n=await d.fetchPostById(e);console.log("post from link",n),this.loader.hide(),this.$el.insertAdjacentHTML("afterbegin",h(n,{withButton:!1}))}}new class extends s{constructor(t){super(t)}init(){localStorage.getItem("visited")&&this.hide(),console.log("init header => ",this.$el);const t=document.querySelector(".js-header-start");console.log("header - btn =>",t),t.addEventListener("click",o.bind(this))}}("header");const p=new class extends s{constructor(t){super(t),this.tabs=[]}init(){console.log("из navigation.init  this.$el  => ",this.$el),this.$el.addEventListener("click",i.bind(this))}registerTabs(t){this.tabs=t}}("navigation");console.log("navigation => ",p);const m=new class extends s{constructor(t){super(t)}}("loader"),b=new class extends s{constructor(t){super(t)}init(){this.$el.addEventListener("submit",u.bind(this)),this.form=new r(this.$el,{title:[l.required],fulltext:[l.required,l.minLength(10)],type:[]})}}("create"),v=new class extends s{constructor(t,{loader:e}){super(t),this.loader=e}init(){this.$el.addEventListener("click",f.bind(this))}async onShow(){this.loader.show();const t=await d.fetchPosts(),e=class{static fbObjectToArray(t){return Object.keys(t).map(e=>{const n=t[e];return n.id=e,n})}}.fbObjectToArray(t);console.log("post onShow, fbData",t),console.log("posts",e);const n=e.map(t=>h(t,{withButton:!0}));this.$el.insertAdjacentHTML("afterbegin",n.join(" ")),this.loader.hide()}onHide(){this.$el.innerHTML=""}}("posts",{loader:m}),y=new class extends s{constructor(t,e){super(t),this.loader=e.loader}init(){this.$el.addEventListener("click",g.bind(this))}onShow(){const t=function(t=[]){return null===t||0===t.length?'<p class="center" >Вы пока ничего не добавили</p>':`\n  <ul>\n    ${t.map(t=>`<li><a href="#" class="js-link">${t}</a></li>`).join(" ")}\n  </ul>\n  `}(JSON.parse(localStorage.getItem("favorites")));this.$el.insertAdjacentHTML("afterbegin",t)}onHide(){this.$el.innerHTML=""}}("favorite",{loader:m});p.registerTabs([{name:"create",component:b},{name:"posts",component:v},{name:"favorite",component:y}])}]);